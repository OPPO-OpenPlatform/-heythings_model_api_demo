/* Generated by the heythings model compiler.  DO NOT EDIT! */
/* Generated from: catLitterBox.proto */

#include <errno.h>
#include <assert.h>
#include "catLitterBox.pb-c.h"
#include "cat_litter_box_service.h"
#include "hey/schema.h"

#define CAT_LITTER_BOX_SERVICE (92 * 256)
#define PROP_IID_CNT 13
#define ACT_IID_CNT 4
#define EV_IID_CNT 14

static const struct hey_schema_property cat_litter_box_properties_iids[] = {
    [0] = { .iid = 1, .type = HEY_PROPERTY_TYPE_GENERIC },
    [1] = { .iid = 2, .type = HEY_PROPERTY_TYPE_GENERIC },
    [2] = { .iid = 3, .type = HEY_PROPERTY_TYPE_GENERIC },
    [3] = { .iid = 4, .type = HEY_PROPERTY_TYPE_GENERIC },
    [4] = { .iid = 5, .type = HEY_PROPERTY_TYPE_GENERIC },
    [5] = { .iid = 6, .type = HEY_PROPERTY_TYPE_GENERIC },
    [6] = { .iid = 7, .type = HEY_PROPERTY_TYPE_ARRAY },
    [7] = { .iid = 8, .type = HEY_PROPERTY_TYPE_GENERIC },
    [8] = { .iid = 9, .type = HEY_PROPERTY_TYPE_GENERIC },
    [9] = { .iid = 10, .type = HEY_PROPERTY_TYPE_GENERIC },
    [10] = { .iid = 25, .type = HEY_PROPERTY_TYPE_GENERIC },
    [11] = { .iid = 30, .type = HEY_PROPERTY_TYPE_GENERIC },
    [12] = { .iid = 31, .type = HEY_PROPERTY_TYPE_GENERIC },
};
static const uint32_t cat_litter_box_event_iids[] = { 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 27, 28, 29 };
static struct hey_service *cat_litter_box_service;

static int32_t action_device_factory_restore_start_cb(void *cb_data, struct hey_action_ctx *ctx, size_t len, uint8_t *value, void **user_context)
{
    int32_t ret = -1;
    Iot__Service__CatLitterBox__ActionInDeviceFactoryRestore *device_factory_restore = iot__service__cat_litter_box__action_in_device_factory_restore__unpack(NULL, len, value);
    if (NULL == device_factory_restore) {
        hey_action_stop(ctx);
        return EINVAL;
    }

    struct cat_litter_box_device_factory_restore_in action = { 0 };
    ret = cat_litter_box_device_factory_restore_start_cb(ctx, &action, user_context);

    iot__service__cat_litter_box__action_in_device_factory_restore__free_unpacked(device_factory_restore, NULL);
    return ret;
}

static void action_device_factory_restore_stop_cb(void *cb_data, void *user_context)
{
    cat_litter_box_device_factory_restore_stop_cb(user_context);
}

/**
 * @brief device factory restore action send message of cat litter box service
 * @param ctx      [action context]
 * @param action   [device factory restore action out]
 * @return int32_t [action send result, 0 means success]
 */
int32_t cat_litter_box_device_factory_restore_send(struct hey_action_ctx *ctx, struct cat_litter_box_device_factory_restore_out *action)
{
    return hey_action_msg_send(ctx, 0, NULL);
}

/**
 * @brief device factory restore action stop of cat litter box service
 * @param ctx      [action context]
 * @return int32_t [action stop result, 0 means success]
 */
int32_t cat_litter_box_device_factory_restore_stop(struct hey_action_ctx *ctx)
{
    return hey_action_stop(ctx);
}

static int32_t action_clean_up_start_cb(void *cb_data, struct hey_action_ctx *ctx, size_t len, uint8_t *value, void **user_context)
{
    int32_t ret = -1;
    Iot__Service__CatLitterBox__ActionInCleanUp *clean_up = iot__service__cat_litter_box__action_in_clean_up__unpack(NULL, len, value);
    if (NULL == clean_up) {
        hey_action_stop(ctx);
        return EINVAL;
    }

    struct cat_litter_box_clean_up_in action = { 0 };
    action.mode = clean_up->mode;
    ret = cat_litter_box_clean_up_start_cb(ctx, &action, user_context);

    iot__service__cat_litter_box__action_in_clean_up__free_unpacked(clean_up, NULL);
    return ret;
}

static void action_clean_up_stop_cb(void *cb_data, void *user_context)
{
    cat_litter_box_clean_up_stop_cb(user_context);
}

/**
 * @brief clean up action send message of cat litter box service
 * @param ctx      [action context]
 * @param action   [clean up action out]
 * @return int32_t [action send result, 0 means success]
 */
int32_t cat_litter_box_clean_up_send(struct hey_action_ctx *ctx, struct cat_litter_box_clean_up_out *action)
{
    int32_t ret = 0;
    Iot__Service__CatLitterBox__ActionOutCleanUp *out = NULL;
    uint8_t *buf = NULL;
    out = malloc(sizeof(Iot__Service__CatLitterBox__ActionOutCleanUp));
    if (NULL == out) {
        ret = ENOMEM;
        goto out;
    }
    iot__service__cat_litter_box__action_out_clean_up__init(out);
    out->code = action->code;
    size_t buf_len = iot__service__cat_litter_box__action_out_clean_up__get_packed_size(out);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            ret = ENOMEM;
            goto out;
        }
    }
    iot__service__cat_litter_box__action_out_clean_up__pack(out, buf);
    ret = hey_action_msg_send(ctx, buf_len, buf);

out:
    free(out);
    free(buf);
    return ret;
}

/**
 * @brief clean up action stop of cat litter box service
 * @param ctx      [action context]
 * @return int32_t [action stop result, 0 means success]
 */
int32_t cat_litter_box_clean_up_stop(struct hey_action_ctx *ctx)
{
    return hey_action_stop(ctx);
}

static int32_t action_cat_toilet_sand_change_start_cb(void *cb_data, struct hey_action_ctx *ctx, size_t len, uint8_t *value, void **user_context)
{
    int32_t ret = -1;
    Iot__Service__CatLitterBox__ActionInCatToiletSandChange *cat_toilet_sand_change = iot__service__cat_litter_box__action_in_cat_toilet_sand_change__unpack(NULL, len, value);
    if (NULL == cat_toilet_sand_change) {
        hey_action_stop(ctx);
        return EINVAL;
    }

    struct cat_litter_box_cat_toilet_sand_change_in action = { 0 };
    action.mode = cat_toilet_sand_change->mode;
    ret = cat_litter_box_cat_toilet_sand_change_start_cb(ctx, &action, user_context);

    iot__service__cat_litter_box__action_in_cat_toilet_sand_change__free_unpacked(cat_toilet_sand_change, NULL);
    return ret;
}

static void action_cat_toilet_sand_change_stop_cb(void *cb_data, void *user_context)
{
    cat_litter_box_cat_toilet_sand_change_stop_cb(user_context);
}

/**
 * @brief cat toilet sand change action send message of cat litter box service
 * @param ctx      [action context]
 * @param action   [cat toilet sand change action out]
 * @return int32_t [action send result, 0 means success]
 */
int32_t cat_litter_box_cat_toilet_sand_change_send(struct hey_action_ctx *ctx, struct cat_litter_box_cat_toilet_sand_change_out *action)
{
    int32_t ret = 0;
    Iot__Service__CatLitterBox__ActionOutCatToiletSandChange *out = NULL;
    uint8_t *buf = NULL;
    out = malloc(sizeof(Iot__Service__CatLitterBox__ActionOutCatToiletSandChange));
    if (NULL == out) {
        ret = ENOMEM;
        goto out;
    }
    iot__service__cat_litter_box__action_out_cat_toilet_sand_change__init(out);
    out->code = action->code;
    size_t buf_len = iot__service__cat_litter_box__action_out_cat_toilet_sand_change__get_packed_size(out);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            ret = ENOMEM;
            goto out;
        }
    }
    iot__service__cat_litter_box__action_out_cat_toilet_sand_change__pack(out, buf);
    ret = hey_action_msg_send(ctx, buf_len, buf);

out:
    free(out);
    free(buf);
    return ret;
}

/**
 * @brief cat toilet sand change action stop of cat litter box service
 * @param ctx      [action context]
 * @return int32_t [action stop result, 0 means success]
 */
int32_t cat_litter_box_cat_toilet_sand_change_stop(struct hey_action_ctx *ctx)
{
    return hey_action_stop(ctx);
}

static int32_t action_cat_sand_smoothing_start_cb(void *cb_data, struct hey_action_ctx *ctx, size_t len, uint8_t *value, void **user_context)
{
    int32_t ret = -1;
    Iot__Service__CatLitterBox__ActionInCatSandSmoothing *cat_sand_smoothing = iot__service__cat_litter_box__action_in_cat_sand_smoothing__unpack(NULL, len, value);
    if (NULL == cat_sand_smoothing) {
        hey_action_stop(ctx);
        return EINVAL;
    }

    struct cat_litter_box_cat_sand_smoothing_in action = { 0 };
    action.mode = cat_sand_smoothing->mode;
    ret = cat_litter_box_cat_sand_smoothing_start_cb(ctx, &action, user_context);

    iot__service__cat_litter_box__action_in_cat_sand_smoothing__free_unpacked(cat_sand_smoothing, NULL);
    return ret;
}

static void action_cat_sand_smoothing_stop_cb(void *cb_data, void *user_context)
{
    cat_litter_box_cat_sand_smoothing_stop_cb(user_context);
}

/**
 * @brief cat sand smoothing action send message of cat litter box service
 * @param ctx      [action context]
 * @param action   [cat sand smoothing action out]
 * @return int32_t [action send result, 0 means success]
 */
int32_t cat_litter_box_cat_sand_smoothing_send(struct hey_action_ctx *ctx, struct cat_litter_box_cat_sand_smoothing_out *action)
{
    int32_t ret = 0;
    Iot__Service__CatLitterBox__ActionOutCatSandSmoothing *out = NULL;
    uint8_t *buf = NULL;
    out = malloc(sizeof(Iot__Service__CatLitterBox__ActionOutCatSandSmoothing));
    if (NULL == out) {
        ret = ENOMEM;
        goto out;
    }
    iot__service__cat_litter_box__action_out_cat_sand_smoothing__init(out);
    out->code = action->code;
    size_t buf_len = iot__service__cat_litter_box__action_out_cat_sand_smoothing__get_packed_size(out);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            ret = ENOMEM;
            goto out;
        }
    }
    iot__service__cat_litter_box__action_out_cat_sand_smoothing__pack(out, buf);
    ret = hey_action_msg_send(ctx, buf_len, buf);

out:
    free(out);
    free(buf);
    return ret;
}

/**
 * @brief cat sand smoothing action stop of cat litter box service
 * @param ctx      [action context]
 * @return int32_t [action stop result, 0 means success]
 */
int32_t cat_litter_box_cat_sand_smoothing_stop(struct hey_action_ctx *ctx)
{
    return hey_action_stop(ctx);
}

static Iot__Service__CatLitterBox__CatInfo *_cat_litter_box_cat_info = NULL;
struct cat_litter_box_cat_info *cat_litter_box_cat_info_unpack(const uint8_t *data, size_t len)
{
    _cat_litter_box_cat_info = iot__service__cat_litter_box__cat_info__unpack(NULL, len, data);
    if (NULL == _cat_litter_box_cat_info) {
        return NULL;
    }
    struct cat_litter_box_cat_info *hey_struct = malloc(sizeof(struct cat_litter_box_cat_info));
    if (NULL == hey_struct) {
        goto out1;
    }
    hey_struct->catid = _cat_litter_box_cat_info->catid;
    hey_struct->weight = _cat_litter_box_cat_info->weight;
    hey_struct->lasttoilettime = _cat_litter_box_cat_info->lasttoilettime;
    return hey_struct;
out1:
    iot__service__cat_litter_box__cat_info__free_unpacked(_cat_litter_box_cat_info, NULL);
    return NULL;
}

void cat_litter_box_cat_info_free_unpacked(struct cat_litter_box_cat_info *data)
{
    assert(NULL != data);
    iot__service__cat_litter_box__cat_info__free_unpacked(_cat_litter_box_cat_info, NULL);
    free(data);
}

int32_t cat_litter_box_cat_info_get_packed_size(const struct cat_litter_box_cat_info *data)
{
    assert(data);
    int ret = 0;
    Iot__Service__CatLitterBox__CatInfo *pb_struct = malloc(sizeof(Iot__Service__CatLitterBox__CatInfo));
    if (pb_struct == NULL) {
        return -1;
    }
    iot__service__cat_litter_box__cat_info__init(pb_struct);
    pb_struct->catid = data->catid;
    pb_struct->weight = data->weight;
    pb_struct->lasttoilettime = data->lasttoilettime;
    ret = iot__service__cat_litter_box__cat_info__get_packed_size(pb_struct);
    free(pb_struct);
    return ret;
}

int32_t cat_litter_box_cat_info_pack(const struct cat_litter_box_cat_info *data, uint8_t *out)
{
    assert(data);
    int ret = 0;
    Iot__Service__CatLitterBox__CatInfo *pb_struct = malloc(sizeof(Iot__Service__CatLitterBox__CatInfo));
    if (pb_struct == NULL) {
        return -1;
    }
    iot__service__cat_litter_box__cat_info__init(pb_struct);
    pb_struct->catid = data->catid;
    pb_struct->weight = data->weight;
    pb_struct->lasttoilettime = data->lasttoilettime;
    ret = iot__service__cat_litter_box__cat_info__pack(pb_struct, out);
    free(pb_struct);
    return ret;
}

static int32_t service_cat_litter_box_properties_write_cb(void *cb_data, size_t n_iid, uint32_t *iids,
                                                          size_t len, uint8_t *value)
{
    Iot__Service__CatLitterBox__Properties *props = iot__service__cat_litter_box__properties__unpack(NULL, len, value);
    if (NULL == props) {
        return EINVAL;
    }

    int32_t ret = 0;
    struct cat_litter_box_properties properties = { 0 };
    struct cat_litter_box_cat_toilet_fault_code cattoiletfaultcode = { 0 };
    struct cat_litter_box_auto_cleanup autocleanup = { 0 };
    struct hey_array_node **catinfo = NULL;
    struct cat_litter_box_no_disturbing_period nodisturbingperiod = { 0 };
    struct cat_litter_box_no_disturbing_period indicatorlightoffperiod = { 0 };
    if (props->cattoiletfaultcode) {
        cattoiletfaultcode.n_code = props->cattoiletfaultcode->n_code;
        if (cattoiletfaultcode.n_code) {
            cattoiletfaultcode.code = malloc(cattoiletfaultcode.n_code * sizeof(int));
            if (cattoiletfaultcode.code == NULL) {
                goto out;
            }
            for (int i = 0; i < cattoiletfaultcode.n_code; i++) {
                cattoiletfaultcode.code[i] = props->cattoiletfaultcode->code[i];
            }
        }
    }
    if (props->autocleanup) {
        autocleanup.enabled = props->autocleanup->enabled;
        autocleanup.delaytostart = props->autocleanup->delaytostart;
    }
    if (props->nodisturbingperiod) {
        nodisturbingperiod.status = props->nodisturbingperiod->status;
        nodisturbingperiod.week = props->nodisturbingperiod->week;
        nodisturbingperiod.fromhour = props->nodisturbingperiod->fromhour;
        nodisturbingperiod.fromminute = props->nodisturbingperiod->fromminute;
        nodisturbingperiod.fromsec = props->nodisturbingperiod->fromsec;
        nodisturbingperiod.tohour = props->nodisturbingperiod->tohour;
        nodisturbingperiod.tominute = props->nodisturbingperiod->tominute;
        nodisturbingperiod.tosec = props->nodisturbingperiod->tosec;
    }
    if (props->indicatorlightoffperiod) {
        indicatorlightoffperiod.status = props->indicatorlightoffperiod->status;
        indicatorlightoffperiod.week = props->indicatorlightoffperiod->week;
        indicatorlightoffperiod.fromhour = props->indicatorlightoffperiod->fromhour;
        indicatorlightoffperiod.fromminute = props->indicatorlightoffperiod->fromminute;
        indicatorlightoffperiod.fromsec = props->indicatorlightoffperiod->fromsec;
        indicatorlightoffperiod.tohour = props->indicatorlightoffperiod->tohour;
        indicatorlightoffperiod.tominute = props->indicatorlightoffperiod->tominute;
        indicatorlightoffperiod.tosec = props->indicatorlightoffperiod->tosec;
    }
    properties.jobstatus = props->jobstatus;
    properties.cattoiletmode = props->cattoiletmode;
    properties.cattoiletfaultcode = &cattoiletfaultcode;
    properties.autocleanup = &autocleanup;
    properties.weight = props->weight;
    properties.cattoiletcatstatus = props->cattoiletcatstatus;
    if (props->n_catinfo) {
        catinfo = calloc(props->n_catinfo, sizeof(struct hey_array_node *));
        if (catinfo == NULL) {
            ret = ENOMEM;
            goto out;
        }
        for (int i = 0; i < props->n_catinfo; i++) {
            catinfo[i] = malloc(sizeof(struct hey_array_node));
            if (catinfo[i] == NULL) {
                ret = ENOMEM;
                goto out;
            }
            catinfo[i]->id = props->catinfo[i]->id;
            catinfo[i]->data.data = props->catinfo[i]->data.data;
            catinfo[i]->data.len = props->catinfo[i]->data.len;
        }
        properties.n_catinfo = props->n_catinfo;
        properties.catinfo = catinfo;
    }
    properties.thenumberoftoiletvisitstoday = props->thenumberoftoiletvisitstoday;
    properties.childlockenabled = props->childlockenabled;
    properties.nodisturbingperiod = &nodisturbingperiod;
    properties.weightissensed = props->weightissensed;
    properties.indicatorlightoffperiod = &indicatorlightoffperiod;
    properties.indicatorlightenabled = props->indicatorlightenabled;
    ret = cat_litter_box_properties_write_cb(n_iid, iids, &properties);

out:
    free(cattoiletfaultcode.code);
    if (catinfo) {
        for (int i = 0; i < props->n_catinfo; i++) {
            free(catinfo[i]);
        }
        free(catinfo);
    }
    iot__service__cat_litter_box__properties__free_unpacked(props, NULL);
    return ret;
}

static int32_t service_cat_litter_box_properties_array_add_cb(void *cb_data, uint32_t iid, size_t len, uint8_t *value)
{
    switch(iid) {
    case CAT_LITTER_BOX_PROPERTY_CATINFO:
        return cat_litter_box_catinfo_array_add_cb(len, value);
    default:
        return -1;
    }
}

static int32_t service_cat_litter_box_properties_array_del_cb(void *cb_data, uint32_t iid, size_t n_id, uint32_t *ids)
{
    switch(iid) {
    case CAT_LITTER_BOX_PROPERTY_CATINFO:
        return cat_litter_box_catinfo_array_del_cb(n_id, ids);
    default:
        return -1;
    }
}

static int32_t service_cat_litter_box_properties_array_replace_cb(void *cb_data, uint32_t iid, uint32_t id, size_t len, uint8_t *value)
{
    switch(iid) {
    case CAT_LITTER_BOX_PROPERTY_CATINFO:
        return cat_litter_box_catinfo_array_replace_cb(id, len, value);
    default:
        return -1;
    }
}

static const struct hey_properties_callbacks props_cbs = {
    .write = service_cat_litter_box_properties_write_cb,
    .array_add = service_cat_litter_box_properties_array_add_cb,
    .array_del = service_cat_litter_box_properties_array_del_cb,
    .array_replace = service_cat_litter_box_properties_array_replace_cb,
};

static const struct hey_action_ctx_callbacks device_factory_restore_cbs = {
    .start = action_device_factory_restore_start_cb,
    .stop = action_device_factory_restore_stop_cb
};

static const struct hey_action_ctx_callbacks clean_up_cbs = {
    .start = action_clean_up_start_cb,
    .stop = action_clean_up_stop_cb
};

static const struct hey_action_ctx_callbacks cat_toilet_sand_change_cbs = {
    .start = action_cat_toilet_sand_change_start_cb,
    .stop = action_cat_toilet_sand_change_stop_cb
};

static const struct hey_action_ctx_callbacks cat_sand_smoothing_cbs = {
    .start = action_cat_sand_smoothing_start_cb,
    .stop = action_cat_sand_smoothing_stop_cb
};

static const struct hey_action_entry actions_iids[] = {
    [0] = { .iid = CAT_LITTER_BOX_ACTION_DEVICE_FACTORY_RESTORE, .type = HEY_ACTION_ONCE, .cbs = &device_factory_restore_cbs },
    [1] = { .iid = CAT_LITTER_BOX_ACTION_CLEAN_UP, .type = HEY_ACTION_ONCE, .cbs = &clean_up_cbs },
    [2] = { .iid = CAT_LITTER_BOX_ACTION_CAT_TOILET_SAND_CHANGE, .type = HEY_ACTION_ONCE, .cbs = &cat_toilet_sand_change_cbs },
    [3] = { .iid = CAT_LITTER_BOX_ACTION_CAT_SAND_SMOOTHING, .type = HEY_ACTION_ONCE, .cbs = &cat_sand_smoothing_cbs },
};

static int cat_litter_box_service_register(Iot__Service__CatLitterBox__Properties *props)
{
    uint8_t *buf;
    size_t buf_len;
    buf_len = iot__service__cat_litter_box__properties__get_packed_size(props);
    if (buf_len == 0) {
        buf = NULL;
    } else {
        buf = malloc(buf_len);
        if (!buf) {
            return ENOMEM;
        }
        iot__service__cat_litter_box__properties__pack(props, buf);
    }

    struct hey_schema_service schema_srv;
    hey_schema_service_init(&schema_srv);
    schema_srv.properties.iids = (struct hey_schema_property *)cat_litter_box_properties_iids;
    schema_srv.properties.n_iid = PROP_IID_CNT;
    schema_srv.properties.value = buf;
    schema_srv.properties.len = buf_len;
    schema_srv.properties.cbs = &props_cbs;
    schema_srv.actions.iids = (struct hey_action_entry *)actions_iids;
    schema_srv.actions.n_iid = ACT_IID_CNT;
    schema_srv.events.iids = (uint32_t *)cat_litter_box_event_iids;
    schema_srv.events.n_iid = EV_IID_CNT;
    cat_litter_box_service = hey_service_register(CAT_LITTER_BOX_SERVICE, &schema_srv, NULL);
    if (NULL == cat_litter_box_service) {
        free(buf);
        return errno;
    }

    free(buf);
    return 0;
}

/**
 * @brief update properties of cat litter box service
 * @param count      [the number of properties to be updated]
 * @param enumerate  [the iid enumeration of properties to be updated]
 * @param properties [properties structure with updated content]
 * @return int32_t   [update result]
 */
int32_t cat_litter_box_properties_update(size_t count, uint32_t *enumerate, struct cat_litter_box_properties *properties)
{
    assert(count <= PROP_IID_CNT);
    if (NULL == properties) {
        return EINVAL;
    }

    int ret = 0;
    Iot__Service__CatLitterBox__Properties *props = NULL;
    uint8_t *buf = NULL;
    Iot__Service__CatLitterBox__CatToiletFaultCode *cattoiletfaultcode = NULL;
    Iot__Service__CatLitterBox__AutoCleanup *autocleanup = NULL;
    ArrayNode **catinfo = NULL;
    Iot__Service__CatLitterBox__NoDisturbingPeriod *nodisturbingperiod = NULL;
    Iot__Service__CatLitterBox__NoDisturbingPeriod *indicatorlightoffperiod = NULL;
    props = malloc(sizeof(Iot__Service__CatLitterBox__Properties));
    if (NULL == props) {
        ret = ENOMEM;
        goto out;
    }
    iot__service__cat_litter_box__properties__init(props);
    if (properties->cattoiletfaultcode) {
        cattoiletfaultcode = malloc(sizeof(Iot__Service__CatLitterBox__CatToiletFaultCode));
        if (NULL == cattoiletfaultcode) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__cat_litter_box__cat_toilet_fault_code__init(cattoiletfaultcode);
        cattoiletfaultcode->n_code = properties->cattoiletfaultcode->n_code;
        if (cattoiletfaultcode->n_code) {
            cattoiletfaultcode->code = malloc(cattoiletfaultcode->n_code * sizeof(int));
            if (cattoiletfaultcode->code == NULL) {
                ret = ENOMEM;
                goto out;
            }
            for (int i = 0; i < cattoiletfaultcode->n_code; i++) {
                cattoiletfaultcode->code[i] = properties->cattoiletfaultcode->code[i];
            }
        }
    }
    if (properties->autocleanup) {
        autocleanup = malloc(sizeof(Iot__Service__CatLitterBox__AutoCleanup));
        if (NULL == autocleanup) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__cat_litter_box__auto_cleanup__init(autocleanup);
        autocleanup->enabled = properties->autocleanup->enabled;
        autocleanup->delaytostart = properties->autocleanup->delaytostart;
    }
    if (properties->n_catinfo) {
        catinfo = calloc(properties->n_catinfo, sizeof(ArrayNode *));
        if (NULL == catinfo) {
            ret = ENOMEM;
            goto out;
        }
        for (int i = 0; i < properties->n_catinfo; i++) {
            catinfo[i] = malloc(sizeof(ArrayNode));
            if (NULL == catinfo[i]) {
                ret = ENOMEM;
                goto out;
            }
            array_node__init(catinfo[i]);
            catinfo[i]->id = properties->catinfo[i]->id;
            catinfo[i]->data.data = properties->catinfo[i]->data.data;
            catinfo[i]->data.len = properties->catinfo[i]->data.len;
        }
    }
    if (properties->nodisturbingperiod) {
        nodisturbingperiod = malloc(sizeof(Iot__Service__CatLitterBox__NoDisturbingPeriod));
        if (NULL == nodisturbingperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__cat_litter_box__no_disturbing_period__init(nodisturbingperiod);
        nodisturbingperiod->status = properties->nodisturbingperiod->status;
        nodisturbingperiod->week = properties->nodisturbingperiod->week;
        nodisturbingperiod->fromhour = properties->nodisturbingperiod->fromhour;
        nodisturbingperiod->fromminute = properties->nodisturbingperiod->fromminute;
        nodisturbingperiod->fromsec = properties->nodisturbingperiod->fromsec;
        nodisturbingperiod->tohour = properties->nodisturbingperiod->tohour;
        nodisturbingperiod->tominute = properties->nodisturbingperiod->tominute;
        nodisturbingperiod->tosec = properties->nodisturbingperiod->tosec;
    }
    if (properties->indicatorlightoffperiod) {
        indicatorlightoffperiod = malloc(sizeof(Iot__Service__CatLitterBox__NoDisturbingPeriod));
        if (NULL == indicatorlightoffperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__cat_litter_box__no_disturbing_period__init(indicatorlightoffperiod);
        indicatorlightoffperiod->status = properties->indicatorlightoffperiod->status;
        indicatorlightoffperiod->week = properties->indicatorlightoffperiod->week;
        indicatorlightoffperiod->fromhour = properties->indicatorlightoffperiod->fromhour;
        indicatorlightoffperiod->fromminute = properties->indicatorlightoffperiod->fromminute;
        indicatorlightoffperiod->fromsec = properties->indicatorlightoffperiod->fromsec;
        indicatorlightoffperiod->tohour = properties->indicatorlightoffperiod->tohour;
        indicatorlightoffperiod->tominute = properties->indicatorlightoffperiod->tominute;
        indicatorlightoffperiod->tosec = properties->indicatorlightoffperiod->tosec;
    }
    props->jobstatus = properties->jobstatus;
    props->cattoiletmode = properties->cattoiletmode;
    props->cattoiletfaultcode = cattoiletfaultcode;
    props->autocleanup = autocleanup;
    props->weight = properties->weight;
    props->cattoiletcatstatus = properties->cattoiletcatstatus;
    props->n_catinfo = properties->n_catinfo;
    props->catinfo = catinfo;
    props->thenumberoftoiletvisitstoday = properties->thenumberoftoiletvisitstoday;
    props->childlockenabled = properties->childlockenabled;
    props->nodisturbingperiod = nodisturbingperiod;
    props->weightissensed = properties->weightissensed;
    props->indicatorlightoffperiod = indicatorlightoffperiod;
    props->indicatorlightenabled = properties->indicatorlightenabled;

    size_t buf_len;
    buf_len = iot__service__cat_litter_box__properties__get_packed_size(props);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__cat_litter_box__properties__pack(props, buf);
    }

    struct hey_properties_content content = {
        .n_iid = count,
        .iids = enumerate,
        .len = buf_len,
        .value = buf
    };
    ret = hey_properties_update(cat_litter_box_service, &content);

out:
    if (cattoiletfaultcode && cattoiletfaultcode->code) {
        free(cattoiletfaultcode->code);
    }
    free(props);
    free(buf);
    free(cattoiletfaultcode);
    free(autocleanup);
    if (catinfo) {
        for (int i = 0; i < properties->n_catinfo; i++) {
            free(catinfo[i]);
        }
        free(catinfo);
    }
    free(nodisturbingperiod);
    free(indicatorlightoffperiod);
    return ret;
}

/**
 * @brief cat litter box service initialization
 * @param properties [cat litter box service properties]
 * @return int32_t   [initialize result]
*/
int32_t cat_litter_box_service_init(const struct cat_litter_box_properties *properties)
{
    int ret = 0;
    Iot__Service__CatLitterBox__Properties *props = NULL;
    Iot__Service__CatLitterBox__CatToiletFaultCode *cattoiletfaultcode = NULL;
    Iot__Service__CatLitterBox__AutoCleanup *autocleanup = NULL;
    ArrayNode **catinfo = NULL;
    Iot__Service__CatLitterBox__NoDisturbingPeriod *nodisturbingperiod = NULL;
    Iot__Service__CatLitterBox__NoDisturbingPeriod *indicatorlightoffperiod = NULL;
    props = malloc(sizeof(Iot__Service__CatLitterBox__Properties));
    if (NULL == props) {
        ret = ENOMEM;
        goto out;
    }
    iot__service__cat_litter_box__properties__init(props);
    if (NULL != properties) {
        if (properties->cattoiletfaultcode) {
            cattoiletfaultcode = malloc(sizeof(Iot__Service__CatLitterBox__CatToiletFaultCode));
            if (NULL == cattoiletfaultcode) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__cat_litter_box__cat_toilet_fault_code__init(cattoiletfaultcode);
            cattoiletfaultcode->n_code = properties->cattoiletfaultcode->n_code;
            cattoiletfaultcode->code = malloc(cattoiletfaultcode->n_code * sizeof(int));
            if (cattoiletfaultcode->code == NULL) {
                ret = ENOMEM;
                goto out;
            }
            for (int i = 0; i < cattoiletfaultcode->n_code; i++) {
                cattoiletfaultcode->code[i] = properties->cattoiletfaultcode->code[i];
            }
        }
        if (properties->autocleanup) {
            autocleanup = malloc(sizeof(Iot__Service__CatLitterBox__AutoCleanup));
            if (NULL == autocleanup) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__cat_litter_box__auto_cleanup__init(autocleanup);
            autocleanup->enabled = properties->autocleanup->enabled;
            autocleanup->delaytostart = properties->autocleanup->delaytostart;
        }
        if (properties->n_catinfo) {
            catinfo = calloc(properties->n_catinfo, sizeof(ArrayNode *));
            if (NULL == catinfo) {
                ret = ENOMEM;
                goto out;
            }
            for (int i = 0; i < properties->n_catinfo; i++) {
                catinfo[i] = malloc(sizeof(ArrayNode));
                if (NULL == catinfo[i]) {
                    ret = ENOMEM;
                    goto out;
                }
                array_node__init(catinfo[i]);
                catinfo[i]->id = properties->catinfo[i]->id;
                catinfo[i]->data.data = properties->catinfo[i]->data.data;
                catinfo[i]->data.len = properties->catinfo[i]->data.len;
            }
        }
        if (properties->nodisturbingperiod) {
            nodisturbingperiod = malloc(sizeof(Iot__Service__CatLitterBox__NoDisturbingPeriod));
            if (NULL == nodisturbingperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__cat_litter_box__no_disturbing_period__init(nodisturbingperiod);
            nodisturbingperiod->status = properties->nodisturbingperiod->status;
            nodisturbingperiod->week = properties->nodisturbingperiod->week;
            nodisturbingperiod->fromhour = properties->nodisturbingperiod->fromhour;
            nodisturbingperiod->fromminute = properties->nodisturbingperiod->fromminute;
            nodisturbingperiod->fromsec = properties->nodisturbingperiod->fromsec;
            nodisturbingperiod->tohour = properties->nodisturbingperiod->tohour;
            nodisturbingperiod->tominute = properties->nodisturbingperiod->tominute;
            nodisturbingperiod->tosec = properties->nodisturbingperiod->tosec;
        }
        if (properties->indicatorlightoffperiod) {
            indicatorlightoffperiod = malloc(sizeof(Iot__Service__CatLitterBox__NoDisturbingPeriod));
            if (NULL == indicatorlightoffperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__cat_litter_box__no_disturbing_period__init(indicatorlightoffperiod);
            indicatorlightoffperiod->status = properties->indicatorlightoffperiod->status;
            indicatorlightoffperiod->week = properties->indicatorlightoffperiod->week;
            indicatorlightoffperiod->fromhour = properties->indicatorlightoffperiod->fromhour;
            indicatorlightoffperiod->fromminute = properties->indicatorlightoffperiod->fromminute;
            indicatorlightoffperiod->fromsec = properties->indicatorlightoffperiod->fromsec;
            indicatorlightoffperiod->tohour = properties->indicatorlightoffperiod->tohour;
            indicatorlightoffperiod->tominute = properties->indicatorlightoffperiod->tominute;
            indicatorlightoffperiod->tosec = properties->indicatorlightoffperiod->tosec;
        }
        props->jobstatus = properties->jobstatus;
        props->cattoiletmode = properties->cattoiletmode;
        props->cattoiletfaultcode = cattoiletfaultcode;
        props->autocleanup = autocleanup;
        props->weight = properties->weight;
        props->cattoiletcatstatus = properties->cattoiletcatstatus;
        props->n_catinfo = properties->n_catinfo;
        props->catinfo = catinfo;
        props->thenumberoftoiletvisitstoday = properties->thenumberoftoiletvisitstoday;
        props->childlockenabled = properties->childlockenabled;
        props->nodisturbingperiod = nodisturbingperiod;
        props->weightissensed = properties->weightissensed;
        props->indicatorlightoffperiod = indicatorlightoffperiod;
        props->indicatorlightenabled = properties->indicatorlightenabled;
    }

    ret = cat_litter_box_service_register(props);

out:
    if (cattoiletfaultcode && cattoiletfaultcode->code) {
        free(cattoiletfaultcode->code);
    }
    free(props);
    free(cattoiletfaultcode);
    free(autocleanup);
    if (catinfo) {
        for (int i = 0; i < properties->n_catinfo; i++) {
            free(catinfo[i]);
        }
        free(catinfo);
    }
    free(nodisturbingperiod);
    free(indicatorlightoffperiod);
    return ret;
}

/**
 * @brief after using the toilet notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_after_using_the_toilet_notify(struct cat_litter_box_event_after_using_the_toilet *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    Iot__Service__CatLitterBox__EventAfterUsingTheToilet *ev = NULL;
    uint8_t *buf = NULL;
    ev = malloc(sizeof(Iot__Service__CatLitterBox__EventAfterUsingTheToilet));
    if (NULL == ev) {
        errno = ENOMEM;
        return ret;
    }
    iot__service__cat_litter_box__event_after_using_the_toilet__init(ev);
    ev->id = event->id;
    ev->weight = event->weight;
    ev->duration = event->duration;

    size_t buf_len;
    buf_len = iot__service__cat_litter_box__event_after_using_the_toilet__get_packed_size(ev);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            errno = ENOMEM;
            goto out;
        }
        iot__service__cat_litter_box__event_after_using_the_toilet__pack(ev, buf);
    }

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_AFTER_USING_THE_TOILET,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = buf_len,
        .value = buf,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_after_using_the_toilet_notify_result_cb, attr->ctx);

out:
    free(ev);
    free(buf);
    return ret;
}

/**
 * @brief auto cleanup start notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_auto_cleanup_start_notify(struct cat_litter_box_event_auto_cleanup_start *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_AUTO_CLEANUP_START,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_auto_cleanup_start_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief auto cleanup end notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_auto_cleanup_end_notify(struct cat_litter_box_event_auto_cleanup_end *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_AUTO_CLEANUP_END,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_auto_cleanup_end_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief start regular cleaning notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_start_regular_cleaning_notify(struct cat_litter_box_event_start_regular_cleaning *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_START_REGULAR_CLEANING,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_start_regular_cleaning_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief end regular cleaning notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_end_regular_cleaning_notify(struct cat_litter_box_event_end_regular_cleaning *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_END_REGULAR_CLEANING,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_end_regular_cleaning_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief cat near notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_cat_near_notify(struct cat_litter_box_event_cat_near *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_CAT_NEAR,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_cat_near_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief cat leaves notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_cat_leaves_notify(struct cat_litter_box_event_cat_leaves *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_CAT_LEAVES,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_cat_leaves_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief manual cleanup end notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_manual_cleanup_end_notify(struct cat_litter_box_event_manual_cleanup_end *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_MANUAL_CLEANUP_END,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_manual_cleanup_end_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief sand change end notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_sand_change_end_notify(struct cat_litter_box_event_sand_change_end *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_SAND_CHANGE_END,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_sand_change_end_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief smoothing end notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_smoothing_end_notify(struct cat_litter_box_event_smoothing_end *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_SMOOTHING_END,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_smoothing_end_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief weight sensor fault notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_weight_sensor_fault_notify(struct cat_litter_box_event_weight_sensor_fault *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_WEIGHT_SENSOR_FAULT,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_weight_sensor_fault_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief motor fault notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_motor_fault_notify(struct cat_litter_box_event_motor_fault *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_MOTOR_FAULT,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_motor_fault_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief cover open notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_cover_open_notify(struct cat_litter_box_event_cover_open *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_COVER_OPEN,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_cover_open_notify_result_cb, attr->ctx);

    return ret;
}

/**
 * @brief roller not in place notify of cat litter box service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t cat_litter_box_roller_not_in_place_notify(struct cat_litter_box_event_roller_not_in_place *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    struct hey_event_notify_content content = {
        .iid = CAT_LITTER_BOX_EVENT_ROLLER_NOT_IN_PLACE,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = 0,
        .value = NULL,
    };
    ret = hey_event_notify(cat_litter_box_service, &content, cat_litter_box_roller_not_in_place_notify_result_cb, attr->ctx);

    return ret;
}
