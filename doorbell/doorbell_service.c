/* Generated by the heythings model compiler.  DO NOT EDIT! */
/* Generated from: doorbell.proto */

#include <errno.h>
#include <assert.h>
#include "doorbell.pb-c.h"
#include "doorbell_service.h"
#include "hey/schema.h"

#define DOORBELL_SERVICE (66 * 256)
#define PROP_IID_CNT 37
#define EV_IID_CNT 5

static const struct hey_schema_property doorbell_properties_iids[] = {
    [0] = { .iid = 1, .type = HEY_PROPERTY_TYPE_GENERIC },
    [1] = { .iid = 2, .type = HEY_PROPERTY_TYPE_GENERIC },
    [2] = { .iid = 3, .type = HEY_PROPERTY_TYPE_GENERIC },
    [3] = { .iid = 4, .type = HEY_PROPERTY_TYPE_GENERIC },
    [4] = { .iid = 5, .type = HEY_PROPERTY_TYPE_GENERIC },
    [5] = { .iid = 6, .type = HEY_PROPERTY_TYPE_GENERIC },
    [6] = { .iid = 7, .type = HEY_PROPERTY_TYPE_GENERIC },
    [7] = { .iid = 8, .type = HEY_PROPERTY_TYPE_GENERIC },
    [8] = { .iid = 9, .type = HEY_PROPERTY_TYPE_GENERIC },
    [9] = { .iid = 10, .type = HEY_PROPERTY_TYPE_GENERIC },
    [10] = { .iid = 11, .type = HEY_PROPERTY_TYPE_GENERIC },
    [11] = { .iid = 12, .type = HEY_PROPERTY_TYPE_GENERIC },
    [12] = { .iid = 13, .type = HEY_PROPERTY_TYPE_GENERIC },
    [13] = { .iid = 14, .type = HEY_PROPERTY_TYPE_GENERIC },
    [14] = { .iid = 15, .type = HEY_PROPERTY_TYPE_GENERIC },
    [15] = { .iid = 16, .type = HEY_PROPERTY_TYPE_GENERIC },
    [16] = { .iid = 17, .type = HEY_PROPERTY_TYPE_GENERIC },
    [17] = { .iid = 18, .type = HEY_PROPERTY_TYPE_GENERIC },
    [18] = { .iid = 19, .type = HEY_PROPERTY_TYPE_GENERIC },
    [19] = { .iid = 20, .type = HEY_PROPERTY_TYPE_GENERIC },
    [20] = { .iid = 21, .type = HEY_PROPERTY_TYPE_GENERIC },
    [21] = { .iid = 22, .type = HEY_PROPERTY_TYPE_GENERIC },
    [22] = { .iid = 23, .type = HEY_PROPERTY_TYPE_GENERIC },
    [23] = { .iid = 24, .type = HEY_PROPERTY_TYPE_GENERIC },
    [24] = { .iid = 25, .type = HEY_PROPERTY_TYPE_GENERIC },
    [25] = { .iid = 26, .type = HEY_PROPERTY_TYPE_GENERIC },
    [26] = { .iid = 27, .type = HEY_PROPERTY_TYPE_GENERIC },
    [27] = { .iid = 28, .type = HEY_PROPERTY_TYPE_GENERIC },
    [28] = { .iid = 29, .type = HEY_PROPERTY_TYPE_GENERIC },
    [29] = { .iid = 30, .type = HEY_PROPERTY_TYPE_GENERIC },
    [30] = { .iid = 31, .type = HEY_PROPERTY_TYPE_GENERIC },
    [31] = { .iid = 32, .type = HEY_PROPERTY_TYPE_GENERIC },
    [32] = { .iid = 33, .type = HEY_PROPERTY_TYPE_GENERIC },
    [33] = { .iid = 34, .type = HEY_PROPERTY_TYPE_GENERIC },
    [34] = { .iid = 35, .type = HEY_PROPERTY_TYPE_ARRAY },
    [35] = { .iid = 36, .type = HEY_PROPERTY_TYPE_ARRAY },
    [36] = { .iid = 37, .type = HEY_PROPERTY_TYPE_GENERIC },
};
static const uint32_t doorbell_event_iids[] = { 38, 39, 40, 41, 42 };
static struct hey_service *doorbell_service;

static Iot__Service__Doorbell__LeaveWord *_doorbell_leave_word = NULL;
struct doorbell_leave_word *doorbell_leave_word_unpack(const uint8_t *data, size_t len)
{
    _doorbell_leave_word = iot__service__doorbell__leave_word__unpack(NULL, len, data);
    if (NULL == _doorbell_leave_word) {
        return NULL;
    }
    struct doorbell_leave_word *hey_struct = malloc(sizeof(struct doorbell_leave_word));
    if (NULL == hey_struct) {
        goto out1;
    }
    hey_struct->url = _doorbell_leave_word->url;
    hey_struct->status = _doorbell_leave_word->status;
    hey_struct->time = _doorbell_leave_word->time;
    hey_struct->autodeleteenabled = _doorbell_leave_word->autodeleteenabled;
    return hey_struct;
out1:
    iot__service__doorbell__leave_word__free_unpacked(_doorbell_leave_word, NULL);
    return NULL;
}

void doorbell_leave_word_free_unpacked(struct doorbell_leave_word *data)
{
    assert(NULL != data);
    iot__service__doorbell__leave_word__free_unpacked(_doorbell_leave_word, NULL);
    free(data);
}

int32_t doorbell_leave_word_get_packed_size(const struct doorbell_leave_word *data)
{
    assert(data);
    int ret = 0;
    Iot__Service__Doorbell__LeaveWord *pb_struct = malloc(sizeof(Iot__Service__Doorbell__LeaveWord));
    if (pb_struct == NULL) {
        return -1;
    }
    iot__service__doorbell__leave_word__init(pb_struct);
    pb_struct->url = data->url;
    pb_struct->status = data->status;
    pb_struct->time = data->time;
    pb_struct->autodeleteenabled = data->autodeleteenabled;
    ret = iot__service__doorbell__leave_word__get_packed_size(pb_struct);
    free(pb_struct);
    return ret;
}

int32_t doorbell_leave_word_pack(const struct doorbell_leave_word *data, uint8_t *out)
{
    assert(data);
    int ret = 0;
    Iot__Service__Doorbell__LeaveWord *pb_struct = malloc(sizeof(Iot__Service__Doorbell__LeaveWord));
    if (pb_struct == NULL) {
        return -1;
    }
    iot__service__doorbell__leave_word__init(pb_struct);
    pb_struct->url = data->url;
    pb_struct->status = data->status;
    pb_struct->time = data->time;
    pb_struct->autodeleteenabled = data->autodeleteenabled;
    ret = iot__service__doorbell__leave_word__pack(pb_struct, out);
    free(pb_struct);
    return ret;
}

static Iot__Service__Doorbell__AutoReply *_doorbell_auto_reply = NULL;
struct doorbell_auto_reply *doorbell_auto_reply_unpack(const uint8_t *data, size_t len)
{
    _doorbell_auto_reply = iot__service__doorbell__auto_reply__unpack(NULL, len, data);
    if (NULL == _doorbell_auto_reply) {
        return NULL;
    }
    struct doorbell_auto_reply *hey_struct = malloc(sizeof(struct doorbell_auto_reply));
    if (NULL == hey_struct) {
        goto out1;
    }
    hey_struct->url = _doorbell_auto_reply->url;
    hey_struct->status = _doorbell_auto_reply->status;
    hey_struct->source = _doorbell_auto_reply->source;
    return hey_struct;
out1:
    iot__service__doorbell__auto_reply__free_unpacked(_doorbell_auto_reply, NULL);
    return NULL;
}

void doorbell_auto_reply_free_unpacked(struct doorbell_auto_reply *data)
{
    assert(NULL != data);
    iot__service__doorbell__auto_reply__free_unpacked(_doorbell_auto_reply, NULL);
    free(data);
}

int32_t doorbell_auto_reply_get_packed_size(const struct doorbell_auto_reply *data)
{
    assert(data);
    int ret = 0;
    Iot__Service__Doorbell__AutoReply *pb_struct = malloc(sizeof(Iot__Service__Doorbell__AutoReply));
    if (pb_struct == NULL) {
        return -1;
    }
    iot__service__doorbell__auto_reply__init(pb_struct);
    pb_struct->url = data->url;
    pb_struct->status = data->status;
    pb_struct->source = data->source;
    ret = iot__service__doorbell__auto_reply__get_packed_size(pb_struct);
    free(pb_struct);
    return ret;
}

int32_t doorbell_auto_reply_pack(const struct doorbell_auto_reply *data, uint8_t *out)
{
    assert(data);
    int ret = 0;
    Iot__Service__Doorbell__AutoReply *pb_struct = malloc(sizeof(Iot__Service__Doorbell__AutoReply));
    if (pb_struct == NULL) {
        return -1;
    }
    iot__service__doorbell__auto_reply__init(pb_struct);
    pb_struct->url = data->url;
    pb_struct->status = data->status;
    pb_struct->source = data->source;
    ret = iot__service__doorbell__auto_reply__pack(pb_struct, out);
    free(pb_struct);
    return ret;
}

static int32_t service_doorbell_properties_write_cb(void *cb_data, size_t n_iid, uint32_t *iids,
                                                    size_t len, uint8_t *value)
{
    Iot__Service__Doorbell__Properties *props = iot__service__doorbell__properties__unpack(NULL, len, value);
    if (NULL == props) {
        return EINVAL;
    }

    int32_t ret = 0;
    struct doorbell_properties properties = { 0 };
    struct doorbell_auto_reply_working_period autoreplyworkingperiod = { 0 };
    struct doorbell_leaving_words_working_period leavingwordsworkingperiod = { 0 };
    struct doorbell_no_disturbing_period nodisturbingperiod = { 0 };
    struct doorbell_motion_detection_working_period motiondetectionworkingperiod = { 0 };
    struct doorbell_push_motion_detect_period pushmotiondetectperiod = { 0 };
    struct doorbell_push_standing_in_doorway_period pushstandingindoorwayperiod = { 0 };
    struct doorbell_push_passing_by_door_period pushpassingbydoorperiod = { 0 };
    struct doorbell_push_doorbell_ringing_period pushdoorbellringingperiod = { 0 };
    struct doorbell_push_leaving_words_period pushleavingwordsperiod = { 0 };
    struct hey_array_node **leaveword = NULL;
    struct hey_array_node **autoreply = NULL;
    if (props->autoreplyworkingperiod) {
        autoreplyworkingperiod.week = props->autoreplyworkingperiod->week;
        autoreplyworkingperiod.fromhour = props->autoreplyworkingperiod->fromhour;
        autoreplyworkingperiod.frommin = props->autoreplyworkingperiod->frommin;
        autoreplyworkingperiod.tohour = props->autoreplyworkingperiod->tohour;
        autoreplyworkingperiod.tomin = props->autoreplyworkingperiod->tomin;
    }
    if (props->leavingwordsworkingperiod) {
        leavingwordsworkingperiod.week = props->leavingwordsworkingperiod->week;
        leavingwordsworkingperiod.fromhour = props->leavingwordsworkingperiod->fromhour;
        leavingwordsworkingperiod.frommin = props->leavingwordsworkingperiod->frommin;
        leavingwordsworkingperiod.tohour = props->leavingwordsworkingperiod->tohour;
        leavingwordsworkingperiod.tomin = props->leavingwordsworkingperiod->tomin;
    }
    if (props->nodisturbingperiod) {
        nodisturbingperiod.week = props->nodisturbingperiod->week;
        nodisturbingperiod.fromhour = props->nodisturbingperiod->fromhour;
        nodisturbingperiod.frommin = props->nodisturbingperiod->frommin;
        nodisturbingperiod.tohour = props->nodisturbingperiod->tohour;
        nodisturbingperiod.tomin = props->nodisturbingperiod->tomin;
    }
    if (props->motiondetectionworkingperiod) {
        motiondetectionworkingperiod.week = props->motiondetectionworkingperiod->week;
        motiondetectionworkingperiod.fromhour = props->motiondetectionworkingperiod->fromhour;
        motiondetectionworkingperiod.frommin = props->motiondetectionworkingperiod->frommin;
        motiondetectionworkingperiod.tohour = props->motiondetectionworkingperiod->tohour;
        motiondetectionworkingperiod.tomin = props->motiondetectionworkingperiod->tomin;
    }
    if (props->pushmotiondetectperiod) {
        pushmotiondetectperiod.week = props->pushmotiondetectperiod->week;
        pushmotiondetectperiod.fromhour = props->pushmotiondetectperiod->fromhour;
        pushmotiondetectperiod.frommin = props->pushmotiondetectperiod->frommin;
        pushmotiondetectperiod.tohour = props->pushmotiondetectperiod->tohour;
        pushmotiondetectperiod.tomin = props->pushmotiondetectperiod->tomin;
    }
    if (props->pushstandingindoorwayperiod) {
        pushstandingindoorwayperiod.week = props->pushstandingindoorwayperiod->week;
        pushstandingindoorwayperiod.fromhour = props->pushstandingindoorwayperiod->fromhour;
        pushstandingindoorwayperiod.frommin = props->pushstandingindoorwayperiod->frommin;
        pushstandingindoorwayperiod.tohour = props->pushstandingindoorwayperiod->tohour;
        pushstandingindoorwayperiod.tomin = props->pushstandingindoorwayperiod->tomin;
    }
    if (props->pushpassingbydoorperiod) {
        pushpassingbydoorperiod.week = props->pushpassingbydoorperiod->week;
        pushpassingbydoorperiod.fromhour = props->pushpassingbydoorperiod->fromhour;
        pushpassingbydoorperiod.frommin = props->pushpassingbydoorperiod->frommin;
        pushpassingbydoorperiod.tohour = props->pushpassingbydoorperiod->tohour;
        pushpassingbydoorperiod.tomin = props->pushpassingbydoorperiod->tomin;
    }
    if (props->pushdoorbellringingperiod) {
        pushdoorbellringingperiod.week = props->pushdoorbellringingperiod->week;
        pushdoorbellringingperiod.fromhour = props->pushdoorbellringingperiod->fromhour;
        pushdoorbellringingperiod.frommin = props->pushdoorbellringingperiod->frommin;
        pushdoorbellringingperiod.tohour = props->pushdoorbellringingperiod->tohour;
        pushdoorbellringingperiod.tomin = props->pushdoorbellringingperiod->tomin;
    }
    if (props->pushleavingwordsperiod) {
        pushleavingwordsperiod.week = props->pushleavingwordsperiod->week;
        pushleavingwordsperiod.fromhour = props->pushleavingwordsperiod->fromhour;
        pushleavingwordsperiod.frommin = props->pushleavingwordsperiod->frommin;
        pushleavingwordsperiod.tohour = props->pushleavingwordsperiod->tohour;
        pushleavingwordsperiod.tomin = props->pushleavingwordsperiod->tomin;
    }
    properties.power = props->power;
    properties.voicechangermode = props->voicechangermode;
    properties.mute = props->mute;
    properties.soundvolume = props->soundvolume;
    properties.resolution = props->resolution;
    properties.motiondetectionenabled = props->motiondetectionenabled;
    properties.motiondetectiondistance = props->motiondetectiondistance;
    properties.motiondetectionrecordduration = props->motiondetectionrecordduration;
    properties.antipryingalarmenabled = props->antipryingalarmenabled;
    properties.autoreplyenabled = props->autoreplyenabled;
    properties.autoreplyworkingperiod = &autoreplyworkingperiod;
    properties.leavingwordsenabled = props->leavingwordsenabled;
    properties.leavingwordsworkingperiod = &leavingwordsworkingperiod;
    properties.ringingsound = props->ringingsound;
    properties.nodisturbingenabled = props->nodisturbingenabled;
    properties.nodisturbingperiod = &nodisturbingperiod;
    properties.pushdoorbellringingenabled = props->pushdoorbellringingenabled;
    properties.pushpassingbydoorenabled = props->pushpassingbydoorenabled;
    properties.pushstandingindoorwayenabled = props->pushstandingindoorwayenabled;
    properties.pushmotiondetectionenabled = props->pushmotiondetectionenabled;
    properties.pushleavingwordsenabled = props->pushleavingwordsenabled;
    properties.pushdoorbellringingsilenttime = props->pushdoorbellringingsilenttime;
    properties.pushantipryingalarmsilenttime = props->pushantipryingalarmsilenttime;
    properties.pushpassingbydoorsilenttime = props->pushpassingbydoorsilenttime;
    properties.pushstandingindoorwaysilenttime = props->pushstandingindoorwaysilenttime;
    properties.pushmotiondetectionsilenttime = props->pushmotiondetectionsilenttime;
    properties.pushleavingwordssilenttime = props->pushleavingwordssilenttime;
    properties.nightvisionenabled = props->nightvisionenabled;
    properties.motiondetectionworkingperiod = &motiondetectionworkingperiod;
    properties.pushmotiondetectperiod = &pushmotiondetectperiod;
    properties.pushstandingindoorwayperiod = &pushstandingindoorwayperiod;
    properties.pushpassingbydoorperiod = &pushpassingbydoorperiod;
    properties.pushdoorbellringingperiod = &pushdoorbellringingperiod;
    properties.pushleavingwordsperiod = &pushleavingwordsperiod;
    if (props->n_leaveword) {
        leaveword = calloc(props->n_leaveword, sizeof(struct hey_array_node *));
        if (leaveword == NULL) {
            ret = ENOMEM;
            goto out;
        }
        for (int i = 0; i < props->n_leaveword; i++) {
            leaveword[i] = malloc(sizeof(struct hey_array_node));
            if (leaveword[i] == NULL) {
                ret = ENOMEM;
                goto out;
            }
            leaveword[i]->id = props->leaveword[i]->id;
            leaveword[i]->data.data = props->leaveword[i]->data.data;
            leaveword[i]->data.len = props->leaveword[i]->data.len;
        }
        properties.n_leaveword = props->n_leaveword;
        properties.leaveword = leaveword;
    }
    if (props->n_autoreply) {
        autoreply = calloc(props->n_autoreply, sizeof(struct hey_array_node *));
        if (autoreply == NULL) {
            ret = ENOMEM;
            goto out;
        }
        for (int i = 0; i < props->n_autoreply; i++) {
            autoreply[i] = malloc(sizeof(struct hey_array_node));
            if (autoreply[i] == NULL) {
                ret = ENOMEM;
                goto out;
            }
            autoreply[i]->id = props->autoreply[i]->id;
            autoreply[i]->data.data = props->autoreply[i]->data.data;
            autoreply[i]->data.len = props->autoreply[i]->data.len;
        }
        properties.n_autoreply = props->n_autoreply;
        properties.autoreply = autoreply;
    }
    properties.passingbydoorthreshold = props->passingbydoorthreshold;
    ret = doorbell_properties_write_cb(n_iid, iids, &properties);

out:
    if (leaveword) {
        for (int i = 0; i < props->n_leaveword; i++) {
            free(leaveword[i]);
        }
        free(leaveword);
    }
    if (autoreply) {
        for (int i = 0; i < props->n_autoreply; i++) {
            free(autoreply[i]);
        }
        free(autoreply);
    }
    iot__service__doorbell__properties__free_unpacked(props, NULL);
    return ret;
}

static int32_t service_doorbell_properties_array_add_cb(void *cb_data, uint32_t iid, size_t len, uint8_t *value)
{
    switch(iid) {
    case DOORBELL_PROPERTY_LEAVEWORD:
        return doorbell_leaveword_array_add_cb(len, value);
    case DOORBELL_PROPERTY_AUTOREPLY:
        return doorbell_autoreply_array_add_cb(len, value);
    default:
        return -1;
    }
}

static int32_t service_doorbell_properties_array_del_cb(void *cb_data, uint32_t iid, size_t n_id, uint32_t *ids)
{
    switch(iid) {
    case DOORBELL_PROPERTY_LEAVEWORD:
        return doorbell_leaveword_array_del_cb(n_id, ids);
    case DOORBELL_PROPERTY_AUTOREPLY:
        return doorbell_autoreply_array_del_cb(n_id, ids);
    default:
        return -1;
    }
}

static int32_t service_doorbell_properties_array_replace_cb(void *cb_data, uint32_t iid, uint32_t id, size_t len, uint8_t *value)
{
    switch(iid) {
    case DOORBELL_PROPERTY_LEAVEWORD:
        return doorbell_leaveword_array_replace_cb(id, len, value);
    case DOORBELL_PROPERTY_AUTOREPLY:
        return doorbell_autoreply_array_replace_cb(id, len, value);
    default:
        return -1;
    }
}

static const struct hey_properties_callbacks props_cbs = {
    .write = service_doorbell_properties_write_cb,
    .array_add = service_doorbell_properties_array_add_cb,
    .array_del = service_doorbell_properties_array_del_cb,
    .array_replace = service_doorbell_properties_array_replace_cb,
};

static int doorbell_service_register(Iot__Service__Doorbell__Properties *props)
{
    uint8_t *buf;
    size_t buf_len;
    buf_len = iot__service__doorbell__properties__get_packed_size(props);
    if (buf_len == 0) {
        buf = NULL;
    } else {
        buf = malloc(buf_len);
        if (!buf) {
            return ENOMEM;
        }
        iot__service__doorbell__properties__pack(props, buf);
    }

    struct hey_schema_service schema_srv;
    hey_schema_service_init(&schema_srv);
    schema_srv.properties.iids = (struct hey_schema_property *)doorbell_properties_iids;
    schema_srv.properties.n_iid = PROP_IID_CNT;
    schema_srv.properties.value = buf;
    schema_srv.properties.len = buf_len;
    schema_srv.properties.cbs = &props_cbs;
    schema_srv.events.iids = (uint32_t *)doorbell_event_iids;
    schema_srv.events.n_iid = EV_IID_CNT;
    doorbell_service = hey_service_register(DOORBELL_SERVICE, &schema_srv, NULL);
    if (NULL == doorbell_service) {
        free(buf);
        return errno;
    }

    free(buf);
    return 0;
}

/**
 * @brief update properties of doorbell service
 * @param count      [the number of properties to be updated]
 * @param enumerate  [the iid enumeration of properties to be updated]
 * @param properties [properties structure with updated content]
 * @return int32_t   [update result]
 */
int32_t doorbell_properties_update(size_t count, uint32_t *enumerate, struct doorbell_properties *properties)
{
    assert(count <= PROP_IID_CNT);
    if (NULL == properties) {
        return EINVAL;
    }

    int ret = 0;
    Iot__Service__Doorbell__Properties *props = NULL;
    uint8_t *buf = NULL;
    Iot__Service__Doorbell__AutoReplyWorkingPeriod *autoreplyworkingperiod = NULL;
    Iot__Service__Doorbell__LeavingWordsWorkingPeriod *leavingwordsworkingperiod = NULL;
    Iot__Service__Doorbell__NoDisturbingPeriod *nodisturbingperiod = NULL;
    Iot__Service__Doorbell__MotionDetectionWorkingPeriod *motiondetectionworkingperiod = NULL;
    Iot__Service__Doorbell__PushMotionDetectPeriod *pushmotiondetectperiod = NULL;
    Iot__Service__Doorbell__PushStandingInDoorwayPeriod *pushstandingindoorwayperiod = NULL;
    Iot__Service__Doorbell__PushPassingByDoorPeriod *pushpassingbydoorperiod = NULL;
    Iot__Service__Doorbell__PushDoorbellRingingPeriod *pushdoorbellringingperiod = NULL;
    Iot__Service__Doorbell__PushLeavingWordsPeriod *pushleavingwordsperiod = NULL;
    ArrayNode **leaveword = NULL;
    ArrayNode **autoreply = NULL;
    props = malloc(sizeof(Iot__Service__Doorbell__Properties));
    if (NULL == props) {
        ret = ENOMEM;
        goto out;
    }
    iot__service__doorbell__properties__init(props);
    if (properties->autoreplyworkingperiod) {
        autoreplyworkingperiod = malloc(sizeof(Iot__Service__Doorbell__AutoReplyWorkingPeriod));
        if (NULL == autoreplyworkingperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__auto_reply_working_period__init(autoreplyworkingperiod);
        autoreplyworkingperiod->week = properties->autoreplyworkingperiod->week;
        autoreplyworkingperiod->fromhour = properties->autoreplyworkingperiod->fromhour;
        autoreplyworkingperiod->frommin = properties->autoreplyworkingperiod->frommin;
        autoreplyworkingperiod->tohour = properties->autoreplyworkingperiod->tohour;
        autoreplyworkingperiod->tomin = properties->autoreplyworkingperiod->tomin;
    }
    if (properties->leavingwordsworkingperiod) {
        leavingwordsworkingperiod = malloc(sizeof(Iot__Service__Doorbell__LeavingWordsWorkingPeriod));
        if (NULL == leavingwordsworkingperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__leaving_words_working_period__init(leavingwordsworkingperiod);
        leavingwordsworkingperiod->week = properties->leavingwordsworkingperiod->week;
        leavingwordsworkingperiod->fromhour = properties->leavingwordsworkingperiod->fromhour;
        leavingwordsworkingperiod->frommin = properties->leavingwordsworkingperiod->frommin;
        leavingwordsworkingperiod->tohour = properties->leavingwordsworkingperiod->tohour;
        leavingwordsworkingperiod->tomin = properties->leavingwordsworkingperiod->tomin;
    }
    if (properties->nodisturbingperiod) {
        nodisturbingperiod = malloc(sizeof(Iot__Service__Doorbell__NoDisturbingPeriod));
        if (NULL == nodisturbingperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__no_disturbing_period__init(nodisturbingperiod);
        nodisturbingperiod->week = properties->nodisturbingperiod->week;
        nodisturbingperiod->fromhour = properties->nodisturbingperiod->fromhour;
        nodisturbingperiod->frommin = properties->nodisturbingperiod->frommin;
        nodisturbingperiod->tohour = properties->nodisturbingperiod->tohour;
        nodisturbingperiod->tomin = properties->nodisturbingperiod->tomin;
    }
    if (properties->motiondetectionworkingperiod) {
        motiondetectionworkingperiod = malloc(sizeof(Iot__Service__Doorbell__MotionDetectionWorkingPeriod));
        if (NULL == motiondetectionworkingperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__motion_detection_working_period__init(motiondetectionworkingperiod);
        motiondetectionworkingperiod->week = properties->motiondetectionworkingperiod->week;
        motiondetectionworkingperiod->fromhour = properties->motiondetectionworkingperiod->fromhour;
        motiondetectionworkingperiod->frommin = properties->motiondetectionworkingperiod->frommin;
        motiondetectionworkingperiod->tohour = properties->motiondetectionworkingperiod->tohour;
        motiondetectionworkingperiod->tomin = properties->motiondetectionworkingperiod->tomin;
    }
    if (properties->pushmotiondetectperiod) {
        pushmotiondetectperiod = malloc(sizeof(Iot__Service__Doorbell__PushMotionDetectPeriod));
        if (NULL == pushmotiondetectperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__push_motion_detect_period__init(pushmotiondetectperiod);
        pushmotiondetectperiod->week = properties->pushmotiondetectperiod->week;
        pushmotiondetectperiod->fromhour = properties->pushmotiondetectperiod->fromhour;
        pushmotiondetectperiod->frommin = properties->pushmotiondetectperiod->frommin;
        pushmotiondetectperiod->tohour = properties->pushmotiondetectperiod->tohour;
        pushmotiondetectperiod->tomin = properties->pushmotiondetectperiod->tomin;
    }
    if (properties->pushstandingindoorwayperiod) {
        pushstandingindoorwayperiod = malloc(sizeof(Iot__Service__Doorbell__PushStandingInDoorwayPeriod));
        if (NULL == pushstandingindoorwayperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__push_standing_in_doorway_period__init(pushstandingindoorwayperiod);
        pushstandingindoorwayperiod->week = properties->pushstandingindoorwayperiod->week;
        pushstandingindoorwayperiod->fromhour = properties->pushstandingindoorwayperiod->fromhour;
        pushstandingindoorwayperiod->frommin = properties->pushstandingindoorwayperiod->frommin;
        pushstandingindoorwayperiod->tohour = properties->pushstandingindoorwayperiod->tohour;
        pushstandingindoorwayperiod->tomin = properties->pushstandingindoorwayperiod->tomin;
    }
    if (properties->pushpassingbydoorperiod) {
        pushpassingbydoorperiod = malloc(sizeof(Iot__Service__Doorbell__PushPassingByDoorPeriod));
        if (NULL == pushpassingbydoorperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__push_passing_by_door_period__init(pushpassingbydoorperiod);
        pushpassingbydoorperiod->week = properties->pushpassingbydoorperiod->week;
        pushpassingbydoorperiod->fromhour = properties->pushpassingbydoorperiod->fromhour;
        pushpassingbydoorperiod->frommin = properties->pushpassingbydoorperiod->frommin;
        pushpassingbydoorperiod->tohour = properties->pushpassingbydoorperiod->tohour;
        pushpassingbydoorperiod->tomin = properties->pushpassingbydoorperiod->tomin;
    }
    if (properties->pushdoorbellringingperiod) {
        pushdoorbellringingperiod = malloc(sizeof(Iot__Service__Doorbell__PushDoorbellRingingPeriod));
        if (NULL == pushdoorbellringingperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__push_doorbell_ringing_period__init(pushdoorbellringingperiod);
        pushdoorbellringingperiod->week = properties->pushdoorbellringingperiod->week;
        pushdoorbellringingperiod->fromhour = properties->pushdoorbellringingperiod->fromhour;
        pushdoorbellringingperiod->frommin = properties->pushdoorbellringingperiod->frommin;
        pushdoorbellringingperiod->tohour = properties->pushdoorbellringingperiod->tohour;
        pushdoorbellringingperiod->tomin = properties->pushdoorbellringingperiod->tomin;
    }
    if (properties->pushleavingwordsperiod) {
        pushleavingwordsperiod = malloc(sizeof(Iot__Service__Doorbell__PushLeavingWordsPeriod));
        if (NULL == pushleavingwordsperiod) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__push_leaving_words_period__init(pushleavingwordsperiod);
        pushleavingwordsperiod->week = properties->pushleavingwordsperiod->week;
        pushleavingwordsperiod->fromhour = properties->pushleavingwordsperiod->fromhour;
        pushleavingwordsperiod->frommin = properties->pushleavingwordsperiod->frommin;
        pushleavingwordsperiod->tohour = properties->pushleavingwordsperiod->tohour;
        pushleavingwordsperiod->tomin = properties->pushleavingwordsperiod->tomin;
    }
    if (properties->n_leaveword) {
        leaveword = calloc(properties->n_leaveword, sizeof(ArrayNode *));
        if (NULL == leaveword) {
            ret = ENOMEM;
            goto out;
        }
        for (int i = 0; i < properties->n_leaveword; i++) {
            leaveword[i] = malloc(sizeof(ArrayNode));
            if (NULL == leaveword[i]) {
                ret = ENOMEM;
                goto out;
            }
            array_node__init(leaveword[i]);
            leaveword[i]->id = properties->leaveword[i]->id;
            leaveword[i]->data.data = properties->leaveword[i]->data.data;
            leaveword[i]->data.len = properties->leaveword[i]->data.len;
        }
    }
    if (properties->n_autoreply) {
        autoreply = calloc(properties->n_autoreply, sizeof(ArrayNode *));
        if (NULL == autoreply) {
            ret = ENOMEM;
            goto out;
        }
        for (int i = 0; i < properties->n_autoreply; i++) {
            autoreply[i] = malloc(sizeof(ArrayNode));
            if (NULL == autoreply[i]) {
                ret = ENOMEM;
                goto out;
            }
            array_node__init(autoreply[i]);
            autoreply[i]->id = properties->autoreply[i]->id;
            autoreply[i]->data.data = properties->autoreply[i]->data.data;
            autoreply[i]->data.len = properties->autoreply[i]->data.len;
        }
    }
    props->power = properties->power;
    props->voicechangermode = properties->voicechangermode;
    props->mute = properties->mute;
    props->soundvolume = properties->soundvolume;
    props->resolution = properties->resolution;
    props->motiondetectionenabled = properties->motiondetectionenabled;
    props->motiondetectiondistance = properties->motiondetectiondistance;
    props->motiondetectionrecordduration = properties->motiondetectionrecordduration;
    props->antipryingalarmenabled = properties->antipryingalarmenabled;
    props->autoreplyenabled = properties->autoreplyenabled;
    props->autoreplyworkingperiod = autoreplyworkingperiod;
    props->leavingwordsenabled = properties->leavingwordsenabled;
    props->leavingwordsworkingperiod = leavingwordsworkingperiod;
    props->ringingsound = properties->ringingsound;
    props->nodisturbingenabled = properties->nodisturbingenabled;
    props->nodisturbingperiod = nodisturbingperiod;
    props->pushdoorbellringingenabled = properties->pushdoorbellringingenabled;
    props->pushpassingbydoorenabled = properties->pushpassingbydoorenabled;
    props->pushstandingindoorwayenabled = properties->pushstandingindoorwayenabled;
    props->pushmotiondetectionenabled = properties->pushmotiondetectionenabled;
    props->pushleavingwordsenabled = properties->pushleavingwordsenabled;
    props->pushdoorbellringingsilenttime = properties->pushdoorbellringingsilenttime;
    props->pushantipryingalarmsilenttime = properties->pushantipryingalarmsilenttime;
    props->pushpassingbydoorsilenttime = properties->pushpassingbydoorsilenttime;
    props->pushstandingindoorwaysilenttime = properties->pushstandingindoorwaysilenttime;
    props->pushmotiondetectionsilenttime = properties->pushmotiondetectionsilenttime;
    props->pushleavingwordssilenttime = properties->pushleavingwordssilenttime;
    props->nightvisionenabled = properties->nightvisionenabled;
    props->motiondetectionworkingperiod = motiondetectionworkingperiod;
    props->pushmotiondetectperiod = pushmotiondetectperiod;
    props->pushstandingindoorwayperiod = pushstandingindoorwayperiod;
    props->pushpassingbydoorperiod = pushpassingbydoorperiod;
    props->pushdoorbellringingperiod = pushdoorbellringingperiod;
    props->pushleavingwordsperiod = pushleavingwordsperiod;
    props->n_leaveword = properties->n_leaveword;
    props->leaveword = leaveword;
    props->n_autoreply = properties->n_autoreply;
    props->autoreply = autoreply;
    props->passingbydoorthreshold = properties->passingbydoorthreshold;

    size_t buf_len;
    buf_len = iot__service__doorbell__properties__get_packed_size(props);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            ret = ENOMEM;
            goto out;
        }
        iot__service__doorbell__properties__pack(props, buf);
    }

    struct hey_properties_content content = {
        .n_iid = count,
        .iids = enumerate,
        .len = buf_len,
        .value = buf
    };
    ret = hey_properties_update(doorbell_service, &content);

out:
    free(props);
    free(buf);
    free(autoreplyworkingperiod);
    free(leavingwordsworkingperiod);
    free(nodisturbingperiod);
    free(motiondetectionworkingperiod);
    free(pushmotiondetectperiod);
    free(pushstandingindoorwayperiod);
    free(pushpassingbydoorperiod);
    free(pushdoorbellringingperiod);
    free(pushleavingwordsperiod);
    if (leaveword) {
        for (int i = 0; i < properties->n_leaveword; i++) {
            free(leaveword[i]);
        }
        free(leaveword);
    }
    if (autoreply) {
        for (int i = 0; i < properties->n_autoreply; i++) {
            free(autoreply[i]);
        }
        free(autoreply);
    }
    return ret;
}

/**
 * @brief doorbell service initialization
 * @param properties [doorbell service properties]
 * @return int32_t   [initialize result]
*/
int32_t doorbell_service_init(const struct doorbell_properties *properties)
{
    int ret = 0;
    Iot__Service__Doorbell__Properties *props = NULL;
    Iot__Service__Doorbell__AutoReplyWorkingPeriod *autoreplyworkingperiod = NULL;
    Iot__Service__Doorbell__LeavingWordsWorkingPeriod *leavingwordsworkingperiod = NULL;
    Iot__Service__Doorbell__NoDisturbingPeriod *nodisturbingperiod = NULL;
    Iot__Service__Doorbell__MotionDetectionWorkingPeriod *motiondetectionworkingperiod = NULL;
    Iot__Service__Doorbell__PushMotionDetectPeriod *pushmotiondetectperiod = NULL;
    Iot__Service__Doorbell__PushStandingInDoorwayPeriod *pushstandingindoorwayperiod = NULL;
    Iot__Service__Doorbell__PushPassingByDoorPeriod *pushpassingbydoorperiod = NULL;
    Iot__Service__Doorbell__PushDoorbellRingingPeriod *pushdoorbellringingperiod = NULL;
    Iot__Service__Doorbell__PushLeavingWordsPeriod *pushleavingwordsperiod = NULL;
    ArrayNode **leaveword = NULL;
    ArrayNode **autoreply = NULL;
    props = malloc(sizeof(Iot__Service__Doorbell__Properties));
    if (NULL == props) {
        ret = ENOMEM;
        goto out;
    }
    iot__service__doorbell__properties__init(props);
    if (NULL != properties) {
        if (properties->autoreplyworkingperiod) {
            autoreplyworkingperiod = malloc(sizeof(Iot__Service__Doorbell__AutoReplyWorkingPeriod));
            if (NULL == autoreplyworkingperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__auto_reply_working_period__init(autoreplyworkingperiod);
            autoreplyworkingperiod->week = properties->autoreplyworkingperiod->week;
            autoreplyworkingperiod->fromhour = properties->autoreplyworkingperiod->fromhour;
            autoreplyworkingperiod->frommin = properties->autoreplyworkingperiod->frommin;
            autoreplyworkingperiod->tohour = properties->autoreplyworkingperiod->tohour;
            autoreplyworkingperiod->tomin = properties->autoreplyworkingperiod->tomin;
        }
        if (properties->leavingwordsworkingperiod) {
            leavingwordsworkingperiod = malloc(sizeof(Iot__Service__Doorbell__LeavingWordsWorkingPeriod));
            if (NULL == leavingwordsworkingperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__leaving_words_working_period__init(leavingwordsworkingperiod);
            leavingwordsworkingperiod->week = properties->leavingwordsworkingperiod->week;
            leavingwordsworkingperiod->fromhour = properties->leavingwordsworkingperiod->fromhour;
            leavingwordsworkingperiod->frommin = properties->leavingwordsworkingperiod->frommin;
            leavingwordsworkingperiod->tohour = properties->leavingwordsworkingperiod->tohour;
            leavingwordsworkingperiod->tomin = properties->leavingwordsworkingperiod->tomin;
        }
        if (properties->nodisturbingperiod) {
            nodisturbingperiod = malloc(sizeof(Iot__Service__Doorbell__NoDisturbingPeriod));
            if (NULL == nodisturbingperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__no_disturbing_period__init(nodisturbingperiod);
            nodisturbingperiod->week = properties->nodisturbingperiod->week;
            nodisturbingperiod->fromhour = properties->nodisturbingperiod->fromhour;
            nodisturbingperiod->frommin = properties->nodisturbingperiod->frommin;
            nodisturbingperiod->tohour = properties->nodisturbingperiod->tohour;
            nodisturbingperiod->tomin = properties->nodisturbingperiod->tomin;
        }
        if (properties->motiondetectionworkingperiod) {
            motiondetectionworkingperiod = malloc(sizeof(Iot__Service__Doorbell__MotionDetectionWorkingPeriod));
            if (NULL == motiondetectionworkingperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__motion_detection_working_period__init(motiondetectionworkingperiod);
            motiondetectionworkingperiod->week = properties->motiondetectionworkingperiod->week;
            motiondetectionworkingperiod->fromhour = properties->motiondetectionworkingperiod->fromhour;
            motiondetectionworkingperiod->frommin = properties->motiondetectionworkingperiod->frommin;
            motiondetectionworkingperiod->tohour = properties->motiondetectionworkingperiod->tohour;
            motiondetectionworkingperiod->tomin = properties->motiondetectionworkingperiod->tomin;
        }
        if (properties->pushmotiondetectperiod) {
            pushmotiondetectperiod = malloc(sizeof(Iot__Service__Doorbell__PushMotionDetectPeriod));
            if (NULL == pushmotiondetectperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__push_motion_detect_period__init(pushmotiondetectperiod);
            pushmotiondetectperiod->week = properties->pushmotiondetectperiod->week;
            pushmotiondetectperiod->fromhour = properties->pushmotiondetectperiod->fromhour;
            pushmotiondetectperiod->frommin = properties->pushmotiondetectperiod->frommin;
            pushmotiondetectperiod->tohour = properties->pushmotiondetectperiod->tohour;
            pushmotiondetectperiod->tomin = properties->pushmotiondetectperiod->tomin;
        }
        if (properties->pushstandingindoorwayperiod) {
            pushstandingindoorwayperiod = malloc(sizeof(Iot__Service__Doorbell__PushStandingInDoorwayPeriod));
            if (NULL == pushstandingindoorwayperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__push_standing_in_doorway_period__init(pushstandingindoorwayperiod);
            pushstandingindoorwayperiod->week = properties->pushstandingindoorwayperiod->week;
            pushstandingindoorwayperiod->fromhour = properties->pushstandingindoorwayperiod->fromhour;
            pushstandingindoorwayperiod->frommin = properties->pushstandingindoorwayperiod->frommin;
            pushstandingindoorwayperiod->tohour = properties->pushstandingindoorwayperiod->tohour;
            pushstandingindoorwayperiod->tomin = properties->pushstandingindoorwayperiod->tomin;
        }
        if (properties->pushpassingbydoorperiod) {
            pushpassingbydoorperiod = malloc(sizeof(Iot__Service__Doorbell__PushPassingByDoorPeriod));
            if (NULL == pushpassingbydoorperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__push_passing_by_door_period__init(pushpassingbydoorperiod);
            pushpassingbydoorperiod->week = properties->pushpassingbydoorperiod->week;
            pushpassingbydoorperiod->fromhour = properties->pushpassingbydoorperiod->fromhour;
            pushpassingbydoorperiod->frommin = properties->pushpassingbydoorperiod->frommin;
            pushpassingbydoorperiod->tohour = properties->pushpassingbydoorperiod->tohour;
            pushpassingbydoorperiod->tomin = properties->pushpassingbydoorperiod->tomin;
        }
        if (properties->pushdoorbellringingperiod) {
            pushdoorbellringingperiod = malloc(sizeof(Iot__Service__Doorbell__PushDoorbellRingingPeriod));
            if (NULL == pushdoorbellringingperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__push_doorbell_ringing_period__init(pushdoorbellringingperiod);
            pushdoorbellringingperiod->week = properties->pushdoorbellringingperiod->week;
            pushdoorbellringingperiod->fromhour = properties->pushdoorbellringingperiod->fromhour;
            pushdoorbellringingperiod->frommin = properties->pushdoorbellringingperiod->frommin;
            pushdoorbellringingperiod->tohour = properties->pushdoorbellringingperiod->tohour;
            pushdoorbellringingperiod->tomin = properties->pushdoorbellringingperiod->tomin;
        }
        if (properties->pushleavingwordsperiod) {
            pushleavingwordsperiod = malloc(sizeof(Iot__Service__Doorbell__PushLeavingWordsPeriod));
            if (NULL == pushleavingwordsperiod) {
                ret = ENOMEM;
                goto out;
            }
            iot__service__doorbell__push_leaving_words_period__init(pushleavingwordsperiod);
            pushleavingwordsperiod->week = properties->pushleavingwordsperiod->week;
            pushleavingwordsperiod->fromhour = properties->pushleavingwordsperiod->fromhour;
            pushleavingwordsperiod->frommin = properties->pushleavingwordsperiod->frommin;
            pushleavingwordsperiod->tohour = properties->pushleavingwordsperiod->tohour;
            pushleavingwordsperiod->tomin = properties->pushleavingwordsperiod->tomin;
        }
        if (properties->n_leaveword) {
            leaveword = calloc(properties->n_leaveword, sizeof(ArrayNode *));
            if (NULL == leaveword) {
                ret = ENOMEM;
                goto out;
            }
            for (int i = 0; i < properties->n_leaveword; i++) {
                leaveword[i] = malloc(sizeof(ArrayNode));
                if (NULL == leaveword[i]) {
                    ret = ENOMEM;
                    goto out;
                }
                array_node__init(leaveword[i]);
                leaveword[i]->id = properties->leaveword[i]->id;
                leaveword[i]->data.data = properties->leaveword[i]->data.data;
                leaveword[i]->data.len = properties->leaveword[i]->data.len;
            }
        }
        if (properties->n_autoreply) {
            autoreply = calloc(properties->n_autoreply, sizeof(ArrayNode *));
            if (NULL == autoreply) {
                ret = ENOMEM;
                goto out;
            }
            for (int i = 0; i < properties->n_autoreply; i++) {
                autoreply[i] = malloc(sizeof(ArrayNode));
                if (NULL == autoreply[i]) {
                    ret = ENOMEM;
                    goto out;
                }
                array_node__init(autoreply[i]);
                autoreply[i]->id = properties->autoreply[i]->id;
                autoreply[i]->data.data = properties->autoreply[i]->data.data;
                autoreply[i]->data.len = properties->autoreply[i]->data.len;
            }
        }
        props->power = properties->power;
        props->voicechangermode = properties->voicechangermode;
        props->mute = properties->mute;
        props->soundvolume = properties->soundvolume;
        props->resolution = properties->resolution;
        props->motiondetectionenabled = properties->motiondetectionenabled;
        props->motiondetectiondistance = properties->motiondetectiondistance;
        props->motiondetectionrecordduration = properties->motiondetectionrecordduration;
        props->antipryingalarmenabled = properties->antipryingalarmenabled;
        props->autoreplyenabled = properties->autoreplyenabled;
        props->autoreplyworkingperiod = autoreplyworkingperiod;
        props->leavingwordsenabled = properties->leavingwordsenabled;
        props->leavingwordsworkingperiod = leavingwordsworkingperiod;
        props->ringingsound = properties->ringingsound;
        props->nodisturbingenabled = properties->nodisturbingenabled;
        props->nodisturbingperiod = nodisturbingperiod;
        props->pushdoorbellringingenabled = properties->pushdoorbellringingenabled;
        props->pushpassingbydoorenabled = properties->pushpassingbydoorenabled;
        props->pushstandingindoorwayenabled = properties->pushstandingindoorwayenabled;
        props->pushmotiondetectionenabled = properties->pushmotiondetectionenabled;
        props->pushleavingwordsenabled = properties->pushleavingwordsenabled;
        props->pushdoorbellringingsilenttime = properties->pushdoorbellringingsilenttime;
        props->pushantipryingalarmsilenttime = properties->pushantipryingalarmsilenttime;
        props->pushpassingbydoorsilenttime = properties->pushpassingbydoorsilenttime;
        props->pushstandingindoorwaysilenttime = properties->pushstandingindoorwaysilenttime;
        props->pushmotiondetectionsilenttime = properties->pushmotiondetectionsilenttime;
        props->pushleavingwordssilenttime = properties->pushleavingwordssilenttime;
        props->nightvisionenabled = properties->nightvisionenabled;
        props->motiondetectionworkingperiod = motiondetectionworkingperiod;
        props->pushmotiondetectperiod = pushmotiondetectperiod;
        props->pushstandingindoorwayperiod = pushstandingindoorwayperiod;
        props->pushpassingbydoorperiod = pushpassingbydoorperiod;
        props->pushdoorbellringingperiod = pushdoorbellringingperiod;
        props->pushleavingwordsperiod = pushleavingwordsperiod;
        props->n_leaveword = properties->n_leaveword;
        props->leaveword = leaveword;
        props->n_autoreply = properties->n_autoreply;
        props->autoreply = autoreply;
        props->passingbydoorthreshold = properties->passingbydoorthreshold;
    }

    ret = doorbell_service_register(props);

out:
    free(props);
    free(autoreplyworkingperiod);
    free(leavingwordsworkingperiod);
    free(nodisturbingperiod);
    free(motiondetectionworkingperiod);
    free(pushmotiondetectperiod);
    free(pushstandingindoorwayperiod);
    free(pushpassingbydoorperiod);
    free(pushdoorbellringingperiod);
    free(pushleavingwordsperiod);
    if (leaveword) {
        for (int i = 0; i < properties->n_leaveword; i++) {
            free(leaveword[i]);
        }
        free(leaveword);
    }
    if (autoreply) {
        for (int i = 0; i < properties->n_autoreply; i++) {
            free(autoreply[i]);
        }
        free(autoreply);
    }
    return ret;
}

/**
 * @brief doorbell ringing notify of doorbell service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t doorbell_doorbell_ringing_notify(struct doorbell_event_doorbell_ringing *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    Iot__Service__Doorbell__EventDoorbellRinging *ev = NULL;
    uint8_t *buf = NULL;
    ev = malloc(sizeof(Iot__Service__Doorbell__EventDoorbellRinging));
    if (NULL == ev) {
        errno = ENOMEM;
        return ret;
    }
    iot__service__doorbell__event_doorbell_ringing__init(ev);
    ev->recordurl = event->recordurl;
    ev->thumbnaiurl = event->thumbnaiurl;

    size_t buf_len;
    buf_len = iot__service__doorbell__event_doorbell_ringing__get_packed_size(ev);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            errno = ENOMEM;
            goto out;
        }
        iot__service__doorbell__event_doorbell_ringing__pack(ev, buf);
    }

    struct hey_event_notify_content content = {
        .iid = DOORBELL_EVENT_DOORBELL_RINGING,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = buf_len,
        .value = buf,
    };
    ret = hey_event_notify(doorbell_service, &content, doorbell_doorbell_ringing_notify_result_cb, attr->ctx);

out:
    free(ev);
    free(buf);
    return ret;
}

/**
 * @brief antiprying alarm notify of doorbell service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t doorbell_antiprying_alarm_notify(struct doorbell_event_antiprying_alarm *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    Iot__Service__Doorbell__EventAntipryingAlarm *ev = NULL;
    uint8_t *buf = NULL;
    ev = malloc(sizeof(Iot__Service__Doorbell__EventAntipryingAlarm));
    if (NULL == ev) {
        errno = ENOMEM;
        return ret;
    }
    iot__service__doorbell__event_antiprying_alarm__init(ev);
    ev->recordurl = event->recordurl;
    ev->thumbnaiurl = event->thumbnaiurl;

    size_t buf_len;
    buf_len = iot__service__doorbell__event_antiprying_alarm__get_packed_size(ev);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            errno = ENOMEM;
            goto out;
        }
        iot__service__doorbell__event_antiprying_alarm__pack(ev, buf);
    }

    struct hey_event_notify_content content = {
        .iid = DOORBELL_EVENT_ANTIPRYING_ALARM,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = buf_len,
        .value = buf,
    };
    ret = hey_event_notify(doorbell_service, &content, doorbell_antiprying_alarm_notify_result_cb, attr->ctx);

out:
    free(ev);
    free(buf);
    return ret;
}

/**
 * @brief motion detection start notify of doorbell service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t doorbell_motion_detection_start_notify(struct doorbell_event_motion_detection_start *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    Iot__Service__Doorbell__EventMotionDetectionStart *ev = NULL;
    uint8_t *buf = NULL;
    ev = malloc(sizeof(Iot__Service__Doorbell__EventMotionDetectionStart));
    if (NULL == ev) {
        errno = ENOMEM;
        return ret;
    }
    iot__service__doorbell__event_motion_detection_start__init(ev);
    ev->eventstarttime = event->eventstarttime;
    ev->resulttype = event->resulttype;
    ev->uploadvideoenable = event->uploadvideoenable;

    size_t buf_len;
    buf_len = iot__service__doorbell__event_motion_detection_start__get_packed_size(ev);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            errno = ENOMEM;
            goto out;
        }
        iot__service__doorbell__event_motion_detection_start__pack(ev, buf);
    }

    struct hey_event_notify_content content = {
        .iid = DOORBELL_EVENT_MOTION_DETECTION_START,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = buf_len,
        .value = buf,
    };
    ret = hey_event_notify(doorbell_service, &content, doorbell_motion_detection_start_notify_result_cb, attr->ctx);

out:
    free(ev);
    free(buf);
    return ret;
}

/**
 * @brief leaving words notify of doorbell service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t doorbell_leaving_words_notify(struct doorbell_event_leaving_words *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    Iot__Service__Doorbell__EventLeavingWords *ev = NULL;
    uint8_t *buf = NULL;
    ev = malloc(sizeof(Iot__Service__Doorbell__EventLeavingWords));
    if (NULL == ev) {
        errno = ENOMEM;
        return ret;
    }
    iot__service__doorbell__event_leaving_words__init(ev);
    ev->recordurl = event->recordurl;
    ev->thumbnaiurl = event->thumbnaiurl;

    size_t buf_len;
    buf_len = iot__service__doorbell__event_leaving_words__get_packed_size(ev);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            errno = ENOMEM;
            goto out;
        }
        iot__service__doorbell__event_leaving_words__pack(ev, buf);
    }

    struct hey_event_notify_content content = {
        .iid = DOORBELL_EVENT_LEAVING_WORDS,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = buf_len,
        .value = buf,
    };
    ret = hey_event_notify(doorbell_service, &content, doorbell_leaving_words_notify_result_cb, attr->ctx);

out:
    free(ev);
    free(buf);
    return ret;
}

/**
 * @brief motion detection end notify of doorbell service
 * @param event    [event content]
 * @param attr     [event details]
 * @return int64_t [event uuid, get error code from errno when return negative value]
*/
int64_t doorbell_motion_detection_end_notify(struct doorbell_event_motion_detection_end *event, struct hey_event_notify_attr *attr)
{
    int64_t ret = -1;

    Iot__Service__Doorbell__EventMotionDetectionEnd *ev = NULL;
    uint8_t *buf = NULL;
    ev = malloc(sizeof(Iot__Service__Doorbell__EventMotionDetectionEnd));
    if (NULL == ev) {
        errno = ENOMEM;
        return ret;
    }
    iot__service__doorbell__event_motion_detection_end__init(ev);
    ev->eventendtime = event->eventendtime;
    ev->resulttype = event->resulttype;

    size_t buf_len;
    buf_len = iot__service__doorbell__event_motion_detection_end__get_packed_size(ev);
    if (buf_len > 0) {
        buf = malloc(buf_len);
        if (NULL == buf) {
            errno = ENOMEM;
            goto out;
        }
        iot__service__doorbell__event_motion_detection_end__pack(ev, buf);
    }

    struct hey_event_notify_content content = {
        .iid = DOORBELL_EVENT_MOTION_DETECTION_END,
        .importance = attr->importance,
        .uuid = attr->uuid,
        .ref_uuid = attr->ref_uuid,
        .timestamp = attr->timestamp,
        .len = buf_len,
        .value = buf,
    };
    ret = hey_event_notify(doorbell_service, &content, doorbell_motion_detection_end_notify_result_cb, attr->ctx);

out:
    free(ev);
    free(buf);
    return ret;
}
